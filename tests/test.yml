---
- name: generic tests for all the roles
  hosts: all
  vars:
    ansible_python_interpreter: /usr/bin/python3
    nftables_output_policy: accept
    nftables_input_rules:
      - tcp dport ssh ct state new limit rate 15/minute accept comment "Accept SSH on port 22 but avoid brute force"
      - tcp dport { http, https } accept comment "Accept HTTP (ports 80, 443)"
      - tcp dport { submission, imaps } accept comment "Accept SSMTP and IMAPS"
    domains:
      - cname: mail.example.org
    hostname: example.org
    hostname_aliases:
      - example
  roles:
    # - ../roles/apt_dist_upgrade
    - ../roles/common
    - ../roles/hostname
    - ../roles/nftables
    - ../roles/sshd
    - ../roles/fail2ban
    # - {role: ../roles/snake_oil_dehydrated, become: true}
    # - {role: ../roles/mailserver}
    # - {role: ../roles/weechat}
    # Uncomment to test wikijs role: it's commented since the tarball that we
    # have to download is more than 60MB.
    # - {role: ../roles/wikijs, become: true, wikijs_db_type: sqlite}
    # - ../roles/adguardhome
    # - {role: ../roles/n8n, become: true}
    # - {role: ../roles/beehive,
    #    become: true,
    #    beehive_bind: 10.10.10.10:8181,
    #    beehive_canonical_url: http://10.10.10.10:8181}
    # - {role: ../roles/homeassistant, become: true}
    # - {role: ../roles/mosquitto, become: true}
    # - {role: ../roles/generate_ca, become: true}
    # - {role: ../roles/generate_certificate, become: true}
    # - {role: ../roles/gitea, become: true}
    # - ../roles/docker
    # - ../roles/dokku
    # The easy ports sequece is just for test. Also don't disable strict IP
    # filtering on production.
    # - {role: ../roles/knockd, ports: [3333, 4444, 5555], network_interface: eth1, filter_ip: ""}
